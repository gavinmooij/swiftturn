---
title: "swiftturn by Gavin Mooij"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
---
```{r setup, include=FALSE}

library(tidyverse)
library(spotifyr)
library(ggrepel)
library(compmus)
library(flexdashboard)
library(plotly)
library(DT)

evermore <- get_playlist_audio_features("","4YtuQ3FLB2w27XFtgmzqU7")
folklore <- get_playlist_audio_features("","4YaaPhq4wawrxM0IqlCXc6")
lover <- get_playlist_audio_features("","1RnBW0qK769pfSuB1Euv4j")
reputation <- get_playlist_audio_features("","7rNUhp9UhkfIs8uHzfSpcS")
nine <- get_playlist_audio_features("","6dRkBAsWQaeYFPS0CVR0FU")
speaknow <- get_playlist_audio_features("","3nb8QcF2HRyvC2ncLjXwwW")
red <- get_playlist_audio_features("","4u9YPeH7Nsk6VMNrwIRW79")
fearless <- get_playlist_audio_features("","5uhG5PWE7CzuSI2eeyOwS3")
taylorswift <- get_playlist_audio_features("","6ojsDGC1I1WWnt4LyzqRnu")

albums <- bind_rows(evermore %>% 
                      mutate(category="evermore"),
                    folklore %>% 
                      mutate(category="folklore"),
                    lover %>% 
                      mutate(category="lover"),
                    reputation %>% 
                      mutate(category="reputation"),
                    nine %>% 
                      mutate(category="1989"),
                    red %>% 
                      mutate(category="red"),
                    speaknow %>% 
                      mutate(category="speaknow"),
                    fearless %>% 
                      mutate(category="fearless"),
                    taylorswift %>% 
                      mutate(category="taylorswift"))

everlore <- bind_rows(evermore %>% 
                      mutate(category="evermore"),
                    folklore %>% 
                      mutate(category="folklore"))

albums.means <- 
  albums %>%
  group_by(playlist_name) %>%
  summarise(
    mean_danceability = mean(danceability),
    mean_acousticness = mean(acousticness),
    mean_energy = mean(energy))

view(albums)

```

### The 180 degree turn of Taylor Swift

My corpus will be about the change that Taylor Swift has been through stylisticly throughout her recent albums.

In july 2020 she suddenly released her eight record, called 'folklore', which was a 180 degree turn from the (pop) sound she used to make. With the record she went back to her country roots and critics called it her best work yet. I was not the biggest Swift fan before this record dropped, but folklore changed the game for me. Every single song on the record is so beautifully written and it became my most listened to album of 2020. Taylor herself was also inspired by this sudden change in her style, and just 5 months later she released folklore's 'sister record' called 'evermore' in december. Where she used to have a big roll-out for a new record and where there would be a couple of years between them to build up hype, these two records were announced the day before they were released. Both folklore and evermore are now considered her two best records she ever made, and I can't stop myself from listening to them over and over again. 

Because these two records were such a big change in style for Taylor, I think it would be really interesting to compare them to her earlier work and see if the songs are actually as different as I believe them to be. Or maybe this sound was always hidden away in her bubblegum pop records of the past and it just never showed? Besides comparing folklore and evermore to her earlier records such as '1989', 'lover' and 'red', I think it would also be interesting to compare folklore and evermore with eachother. Because they are in fact "sister albums", how much are they alike? 

### Comparing every single record she released since the start of her career

```{r}
albums.sp.energy <- albums.means %>%
  ggplot(aes(mean_energy,mean_danceability ,color = playlist_name, size=mean_acousticness))  + geom_point() + expand_limits(x=c(0.35,0.75), y=c(0.5,0.675))  + labs(y= "Danceability", x = " Energy",size='Acousticness')  + guides (color=FALSE)

albums.sp.energy + geom_text_repel(aes(color=playlist_name,label=playlist_name,size=0.4,hjust=0.4,vjust=0.5))

```

***
The first thing I wanted to do, was just compare every record she released and just observer where differences lie. 

Here I let R calculate the respective means of the albums, and in the scatter plot above you see the mean energy, mean danceability and mean acousticness. Immediately you see folklore and evermore in their own corner, with especially 1989 (her most succesful record chart-wise) in the complete opposite. Her two latest albums also show a difference in acousticness as they are the biggest dots in the graphs. I think this is a good starting point for further comparisons. 

The respective standard deviations of the means : 

```{r}
albums.sd <- 
  albums %>%
  group_by(playlist_name) %>%
  summarise(
    sd_danceability = sd(danceability),
    sd_acousticness = sd(acousticness),
    sd_energy = sd(energy))

library(knitr)
kable(albums.sd, caption = "The respective standard deviations of the means :", col.names = c('Album', 'Danceability', 'Acousticness', 'Energy'),digits = 2,"simple")

```


### Determining outliers in the two sister albums versus 1989

```{r}
ef1989 <-
  evermore %>%
  mutate(category = "evermore") %>%
  bind_rows(folklore %>% mutate(category = "folklore")) %>%
  bind_rows(nine %>% mutate(category = "1998")) %>%
  mutate(
    category = fct_relevel(category, "evermore", "folklore", "1998")
  )
outliers <-
  ef1989 %>%
  ggplot(                          # Set up the plot.
    aes(
      x = valence,
      y = energy,
      colour = acousticness,
      size = track.popularity,
      label = track.name          # Labels will be interactively visible.
    )
  ) +
  geom_point() +                   # Scatter plot.
  geom_rug(size = 0.1) +           # Add 'fringes' to show data distribution.
  facet_wrap(~category) +           # Separate charts per country.
  scale_x_continuous(              # Fine-tune the x axis.
    limits = c(0,1, 1),
    breaks = c(0, 0.50, 1),        # Use grid-lines for quadrants only.
    minor_breaks = NULL            # Remove 'minor' grid-lines.
  ) +
  scale_y_continuous(              # Fine-tune the y axis in the same way.
    limits = c(0.3, 0.85),
    breaks = c(0, 0.50, 1),
    minor_breaks = NULL
  ) +
  scale_colour_viridis_c(          # Use the cividis palette
    option = "E",                  # Qualitative set.
    alpha = 0.8,                   # Include some transparency
    guide = "none"
  ) +
  scale_size_continuous(           # Fine-tune the sizes of each point.
    guide = "none"                 # Remove the legend for size.
  ) +
  theme_light() +                  # Use a simpler theme.
  labs(                            # Make the titles nice.
    x = "Valence",
    y = "Energy"
  )
ggplotly(outliers)

```

***
I decided to continue this journey of comparison with her two most recent records 'evermore' and 'folklore', and the record that stood the farthest from the two in the graph you saw in the last tab; '1989'. For the record, '1989' is also one of Taylor Swifts most succesful albums to date, so I thought it would be interesting to compare the three. 

In these graphs, size is determined by the popularity of the track and color is determined by acousticness. The more yellow the dot, the more acoustic the track. 

### Chromagram
```{r}
wood <-
  get_tidy_audio_analysis("6IQILcYkN2S2eSu5IHoPEH") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)

wood %>%
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()
```
***
The magical chromagram!!

### Self similarity matrix
```{r}
bzt <-
  get_tidy_audio_analysis("5DiDE0bSiuX3J2hSyXTXRT") %>% # Change URI.
  compmus_align(bars, segments) %>%                     # Change `bars`
  select(bars) %>%                                      #   in all three
  unnest(bars) %>%                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) %>%
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )

bzt %>%
  compmus_self_similarity(timbre, "manhattan") %>% 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "")
```

***
A self similarity matrix woohoo 

### Amber
```{r}
amberalora <- get_playlist_audio_features("","6EvTdMuzSdgR71QWgPEiZO")
amberalora.plot <- amberalora %>%
  ggplot(aes(energy,valence, color=track.name, size = danceability)) + geom_point()

amberalora.plot + geom_text_repel(aes(color=track.name,label=track.name,size=0.6,hjust=0.4,vjust=0.5))  + guides (color=FALSE)
amberalora.plot

amberalora
```
***
Ambers dingetje







